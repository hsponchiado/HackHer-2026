<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SafeSpace AI</title>
  <!-- Local CSS â€” no CDN dependencies -->
  <link rel="stylesheet" href="popup.css" />
</head>
<body>

  <!-- â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="header" role="banner">
    <div class="header-inner flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="relative">
          <div class="w-10 h-10 rounded-full flex items-center justify-center pulse"
               style="background:rgba(255,255,255,0.2)" aria-hidden="true">
            <span style="font-size:20px">ğŸ›¡ï¸</span>
          </div>
        </div>
        <div>
          <h1 style="font-size:18px;color:#fff;font-weight:700;line-height:1.2">SafeSpace AI</h1>
          <p id="status-label" style="font-size:11px;color:rgba(255,255,255,0.75);margin-top:1px"
             role="status" aria-live="polite">Scanning active</p>
        </div>
      </div>
      <!-- Master toggle -->
      <div class="flex items-center gap-2">
        <span id="toggle-text" style="font-size:12px;color:rgba(255,255,255,0.8);font-weight:500"
              aria-hidden="true">ON</span>
        <div class="toggle-track on" id="master-toggle"
             role="switch" aria-checked="true" aria-label="Enable protection" tabindex="0">
          <div class="toggle-thumb"></div>
        </div>
      </div>
    </div>

    <!-- Mini stat bar -->
    <div class="header-inner flex gap-4 mt-4" role="region" aria-label="Quick statistics">
      <div class="text-center">
        <div id="hdr-blocked" style="font-size:22px;font-weight:700;color:#fff;line-height:1"
             aria-label="Items blocked">0</div>
        <div style="font-size:10px;color:rgba(255,255,255,0.65)" aria-hidden="true">Blocked</div>
      </div>
      <div style="width:1px;background:rgba(255,255,255,0.2)" role="separator"></div>
      <div class="text-center">
        <div id="hdr-scanned" style="font-size:22px;font-weight:700;color:#fff;line-height:1"
             aria-label="Items scanned">0</div>
        <div style="font-size:10px;color:rgba(255,255,255,0.65)" aria-hidden="true">Scanned</div>
      </div>
      <div style="width:1px;background:rgba(255,255,255,0.2)" role="separator"></div>
      <div class="text-center">
        <div id="hdr-sessions" style="font-size:22px;font-weight:700;color:#fff;line-height:1"
             aria-label="Sessions protected">0</div>
        <div style="font-size:10px;color:rgba(255,255,255,0.65)" aria-hidden="true">Sessions</div>
      </div>
    </div>
  </div>

  <!-- â”€â”€ Tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div style="background:#fff;border-bottom:1px solid #f0e4f0;padding:0 16px"
       role="navigation" aria-label="Panel sections">
    <div class="flex" role="tablist">
      <button class="tab-btn active" data-tab="protect"
              role="tab" aria-selected="true" aria-controls="tab-protect" id="btn-protect">ğŸ”’ Protect</button>
      <button class="tab-btn" data-tab="stats"
              role="tab" aria-selected="false" aria-controls="tab-stats" id="btn-stats">ğŸ“Š Stats</button>
      <button class="tab-btn" data-tab="filters"
              role="tab" aria-selected="false" aria-controls="tab-filters" id="btn-filters">âš™ï¸ Filters</button>
      <button class="tab-btn" data-tab="evidence"
              role="tab" aria-selected="false" aria-controls="tab-evidence" id="btn-evidence">ğŸ“‹ Evidence</button>
    </div>
  </div>

  <div style="padding:16px;overflow-y:auto;max-height:340px" role="main">

    <!-- â”€â”€ Tab: Protect â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="tab-pane active animate-fade-up" id="tab-protect"
         role="tabpanel" aria-labelledby="btn-protect">

      <!-- Sensitivity -->
      <div class="stat-card mb-3">
        <div class="flex items-center justify-between mb-2">
          <div>
            <label for="sensitivity-slider"
                   style="font-size:13px;font-weight:600;color:var(--text);display:block">
              Detection Sensitivity
            </label>
            <p style="font-size:11px;color:var(--muted)" id="slider-desc">Higher = stricter filtering</p>
          </div>
          <span id="threshold-display" style="font-size:18px;font-weight:700;color:var(--rose)"
                aria-live="polite">70%</span>
        </div>
        <input type="range" id="sensitivity-slider" min="0" max="100" value="70" style="--val:70%"
               aria-describedby="slider-desc" aria-valuemin="0" aria-valuemax="100" aria-valuenow="70" />
        <div class="flex justify-between mt-1" style="font-size:10px;color:var(--muted)" aria-hidden="true">
          <span>Lenient</span><span>Balanced</span><span>Strict</span>
        </div>
      </div>

      <!-- Blur strength -->
      <div class="stat-card mb-3">
        <p style="font-size:13px;font-weight:600;color:var(--text);margin-bottom:8px" id="blur-label">Blur Strength</p>
        <div class="flex gap-2" role="group" aria-labelledby="blur-label">
          <button class="blur-pill" data-blur="light" aria-pressed="false">Light</button>
          <button class="blur-pill active" data-blur="medium" aria-pressed="true">Medium</button>
          <button class="blur-pill" data-blur="heavy" aria-pressed="false">Heavy</button>
        </div>
      </div>

      <!-- Notifications & Evidence Mode -->
      <div class="stat-card mb-3">
        <div class="flex flex-col gap-3">
          <div class="flex items-center justify-between">
            <div>
              <p style="font-size:13px;font-weight:500" id="notif-label">Notifications</p>
              <p style="font-size:11px;color:var(--muted)">Alert when content is detected</p>
            </div>
            <div class="toggle-track on" id="notif-toggle"
                 role="switch" aria-checked="true" aria-labelledby="notif-label" tabindex="0"
                 style="background:rgba(224,92,122,0.3);border:1px solid rgba(224,92,122,0.4)">
              <div class="toggle-thumb"></div>
            </div>
          </div>
          <div style="height:1px;background:#f0e4f0" role="separator"></div>
          <div class="flex items-center justify-between">
            <div>
              <p style="font-size:13px;font-weight:500" id="evidence-label">Evidence Mode</p>
              <p style="font-size:11px;color:var(--muted)">Capture button on flagged content</p>
            </div>
            <div class="toggle-track" id="evidence-toggle"
                 role="switch" aria-checked="false" aria-labelledby="evidence-label" tabindex="0"
                 style="border:1px solid rgba(224,92,122,0.4)">
              <div class="toggle-thumb"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- API Key -->
      <div class="stat-card">
        <div class="flex items-center justify-between mb-2">
          <div>
            <p style="font-size:13px;font-weight:600" id="apikey-label">Perspective API Key</p>
            <p style="font-size:11px;color:var(--muted)">Required for toxicity analysis</p>
          </div>
          <a href="https://perspectiveapi.com/" target="_blank" rel="noopener noreferrer"
             style="font-size:11px;color:var(--rose);text-decoration:none"
             aria-label="Get Perspective API key (opens new tab)">Get key â†’</a>
        </div>
        <input class="api-input" id="api-key-input" type="password" placeholder="AIzaâ€¦"
               autocomplete="off" aria-labelledby="apikey-label" aria-describedby="api-status" />
        <div class="flex gap-2 mt-2">
          <button class="btn-primary flex-1" id="save-api-key">Save Key</button>
          <button class="btn-ghost" id="test-api-key">Test</button>
        </div>
        <p id="api-status" style="font-size:11px;margin-top:6px;min-height:16px"
           role="status" aria-live="polite"></p>
      </div>
    </div>

    <!-- â”€â”€ Tab: Stats â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="tab-pane animate-fade-up" id="tab-stats"
         role="tabpanel" aria-labelledby="btn-stats">
      <div class="grid grid-cols-2 gap-3 mb-3">
        <div class="stat-card text-center">
          <div id="stat-blocked-big" style="font-size:28px;font-weight:700;color:var(--rose);line-height:1"
               aria-label="Total items blocked">0</div>
          <div style="font-size:11px;color:var(--muted);margin-top:2px">Items Blocked</div>
        </div>
        <div class="stat-card text-center">
          <div id="stat-sessions-big" style="font-size:28px;font-weight:700;color:#8a60e0;line-height:1"
               aria-label="Sessions protected">0</div>
          <div style="font-size:11px;color:var(--muted);margin-top:2px">Sessions Protected</div>
        </div>
      </div>

      <!-- Category breakdown -->
      <div class="stat-card mb-3">
        <p style="font-size:13px;font-weight:600;margin-bottom:10px">By Category</p>
        <div id="category-bars" class="flex flex-col gap-2" role="list" aria-label="Detections by category">
          <p style="font-size:12px;color:var(--muted);text-align:center;padding:8px 0">No detections yet</p>
        </div>
      </div>

      <!-- Recent events -->
      <div class="stat-card">
        <div class="flex items-center justify-between mb-2">
          <p style="font-size:13px;font-weight:600">Recent Detections</p>
          <button id="clear-stats-btn" class="btn-ghost" style="padding:4px 10px;font-size:11px"
                  aria-label="Clear all statistics">Clear</button>
        </div>
        <div id="recent-events" class="flex flex-col gap-1" role="list" aria-label="Recent detection events">
          <p style="font-size:12px;color:var(--muted);text-align:center;padding:8px 0">No events yet</p>
        </div>
      </div>
    </div>

    <!-- â”€â”€ Tab: Filters â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="tab-pane animate-fade-up" id="tab-filters"
         role="tabpanel" aria-labelledby="btn-filters">
      <div class="stat-card mb-3">
        <p style="font-size:13px;font-weight:600;margin-bottom:12px" id="filter-group-label">Content Categories</p>
        <fieldset style="border:none;padding:0" aria-labelledby="filter-group-label">
          <div class="flex flex-col gap-3" id="filter-list">
            <!-- Injected by JS -->
          </div>
        </fieldset>
      </div>

      <div class="stat-card">
        <p style="font-size:13px;font-weight:600;margin-bottom:8px" id="profile-group-label">Protection Profile</p>
        <div class="flex flex-col gap-2" role="group" aria-labelledby="profile-group-label">
          <button class="btn-ghost" data-profile="gentle"
                  style="text-align:left;display:flex;align-items:center;gap:8px"
                  aria-label="Gentle profile: blocks only the most severe content">
            <span aria-hidden="true">ğŸŒ¸</span>
            <div><strong style="font-size:12px">Gentle</strong><br/>
            <small style="color:var(--muted);font-size:11px">Blocks only the most severe content</small></div>
          </button>
          <button class="btn-ghost" data-profile="balanced"
                  style="text-align:left;display:flex;align-items:center;gap:8px"
                  aria-label="Balanced profile: recommended default settings">
            <span aria-hidden="true">âš–ï¸</span>
            <div><strong style="font-size:12px">Balanced</strong><br/>
            <small style="color:var(--muted);font-size:11px">Recommended default settings</small></div>
          </button>
          <button class="btn-ghost" data-profile="strict"
                  style="text-align:left;display:flex;align-items:center;gap:8px"
                  aria-label="Strict profile: maximum protection, all categories">
            <span aria-hidden="true">ğŸ”’</span>
            <div><strong style="font-size:12px">Strict</strong><br/>
            <small style="color:var(--muted);font-size:11px">Maximum protection, all categories</small></div>
          </button>
        </div>
      </div>
    </div>

    <!-- â”€â”€ Tab: Evidence â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="tab-pane animate-fade-up" id="tab-evidence"
         role="tabpanel" aria-labelledby="btn-evidence">
      <div class="stat-card mb-3">
        <p style="font-size:12px;color:var(--muted);line-height:1.5;margin-bottom:8px">
          When <strong>Evidence Mode</strong> is enabled, you can capture flagged content for
          reporting. Evidence is stored locally and never uploaded.
        </p>
        <button id="export-evidence-btn" class="btn-primary" style="width:100%"
                aria-label="Export all evidence as JSON file">ğŸ“¤ Export All Evidence</button>
      </div>
      <div id="evidence-list" class="flex flex-col gap-2" role="list" aria-label="Captured evidence items">
        <p style="font-size:12px;color:var(--muted);text-align:center;padding:16px 0">
          No evidence captured yet
        </p>
      </div>
    </div>

  </div>

  <!-- â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <footer style="padding:10px 16px;background:#fff;border-top:1px solid #f0e4f0;
                 display:flex;align-items:center;justify-content:space-between">
    <span style="font-size:11px;color:var(--muted)">SafeSpace AI v1.0.0</span>
    <span style="font-size:11px;color:var(--muted)">ğŸ”’ Privacy-first</span>
  </footer>

  <script src="popup.js"></script>
</body>
</html>
